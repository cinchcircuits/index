<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.79.1"><link rel=canonical type=text/html href=https://docs.indexmachines.io/branch/doc/docs/motherboard/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/branch/doc/favicons/favicon.ico><link rel=apple-touch-icon href=/branch/doc/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/branch/doc/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/branch/doc/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/branch/doc/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/branch/doc/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/branch/doc/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/branch/doc/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/branch/doc/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/branch/doc/favicons/android-192x192.png sizes=192x192><title>Motherboard Installation | Index</title><meta property="og:title" content="Motherboard Installation"><meta property="og:description" content="Section containing reference documentation."><meta property="og:type" content="website"><meta property="og:url" content="https://docs.indexmachines.io/branch/doc/docs/motherboard/"><meta property="og:site_name" content="Index"><meta itemprop=name content="Motherboard Installation"><meta itemprop=description content="Section containing reference documentation."><meta name=twitter:card content="summary"><meta name=twitter:title content="Motherboard Installation"><meta name=twitter:description content="Section containing reference documentation."><link rel=preload href=/branch/doc/scss/main.min.265e25987f1ebc366519dbb651d5dae8ec9c3b7dafaba1ff236240d5774ecae7.css as=style><link href=/branch/doc/scss/main.min.265e25987f1ebc366519dbb651d5dae8ec9c3b7dafaba1ff236240d5774ecae7.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/branch/doc/><span class=navbar-logo><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.0" width="50" height="50" viewBox="0 0 37.5 37.5" id="svg2015" sodipodi:docname="logo.svg" inkscape:version="0.92.2 5c3e80d, 2017-08-06"><defs id="defs2019"/><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1736" inkscape:window-height="1074" id="namedview2017" showgrid="false" inkscape:zoom="17.22" inkscape:cx="25" inkscape:cy="25" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="0" inkscape:current-layer="g2013" units="px"/><g transform="matrix(0.1,0,0,-0.1,0,37.5)" id="g2013" style="fill:#000;stroke:none"><path d="M0 187.5V0H187.5 375V187.5 375H187.5.0zm200.33333 171.16667c1-1 1.33334-3.08334 1.33334-8.58334V342.75l5.25-.58333c23.25-2.66667 51.41666-13.58334 71.41666-27.83334 10.16667-7.16666 28-25 35.16667-35.16666 14.25-20 25.16667-48.16667 27.83333-71.41667l.58334-5.25H349.25c10.08333.0 9.91667.25 9.91667-14.58333.0-14.83334.16666-14.58334-9.91667-14.58334h-7.33333l-.58334-5.16666c-1.75-15.58334-6.75-32.16667-14.25-47.83334C311.66667 88.083333 288.83333 64.833333 256.75 48.75c-15.08333-7.5-34-13.25-49.83333-15l-5.25-.583333v-7.333334c0-10.166666.25-10-14.58334-10C172.25 15.833333 172.5 15.666667 172.5 25.75v7.333333l-5.16667.583334c-16.25 1.833333-34.41666 7.5-51.25 15.916666C99.833333 57.833333 90.25 64.75 77.083333 77.916667 63.916667 91.083333 57 100.66667 48.75 116.91667 40.166667 134 34.666667 151.83333 32.833333 168.16667L32.25 173.33333H24.916667C14.833333 173.33333 15 173.08333 15 187.91667 15 202.75 14.833333 202.5 24.916667 202.5H32.25l.583333 5.25c1.833334 16.25 7.333334 34.08333 15.916667 51.16667 8.25 16.25 15.166667 25.83333 28.333333 39C90.25 311.08333 99.833333 318 116.08333 326.25c17 8.58333 34.58334 14 51.25 15.91667L172.5 342.75v7.33333c0 10.08334-.25 9.91667 14.58333 9.91667 9.75.0 12.16667-.25 13.25-1.33333z" id="path2005" style="fill:none;stroke-width:.08333334" inkscape:connector-curvature="0"/><path d="m177.5 347.08333c0-9.91666.83333-9.08333-9.16667-10C141.41667 334.5 110.25 320.5 87.833333 300.91667 61 277.58333 42.333333 242.83333 38.25 209 36.75 196.16667 38 197.5 27.916667 197.5h-8.75v-9.58333-9.58334h8.75c10 0 8.833333 1.33334 10.333333-11.33333C42.333333 132.91667 61.5 97.5 88.333333 74.416667 110.91667 55.083333 141.75 41.333333 168.33333 38.75c10-.916667 9.16667-.08333 9.16667-10V20h9.58333 9.58334v8.75c0 10.083333-1.33334 8.833333 11.5 10.333333 42.5 5.083334 84.25 32.416667 107.16666 70.249997 11 18.08334 19.16667 41.5 20.91667 59.83334.91667 10 .0833 9.16666 10 9.16666H355v9.58334 9.58333h-8.75c-9.91667.0-9.08333-.83333-10 9.16667-1.91667 20.08333-11.75 46.5-24.33333 65.16666C288.33333 307 248.5 331.91667 208.16667 336.75c-12.83334 1.5-11.5.25-11.5 10.33333v8.75H187.08333 177.5zm0-70V235h9.58333 9.58334v42 42l4-.41667C221.33333 316.5 245 307.66667 262.58333 295.41667c9.83334-6.83334 26.58334-23.91667 33.16667-33.75 12-18.08334 20-39.91667 22-60.16667l.41667-4H303.25 288.33333v-9.58333-9.58334h15 15L318 176.5c-.25-1.08333-.66667-4.08333-.91667-6.75C316.25 162 312.75 148.91667 309.16667 139.66667 296.25 106.66667 268.33333 78.75 235.33333 65.833333 226.08333 62.25 213 58.75 205.25 57.916667 202.58333 57.666667 199.58333 57.25 198.58333 57l-1.91666-.333333v15 15H187.08333 177.5v-15-15L175.66667 57c-1.08334.25-4.08334.666667-6.75.916667C166.25 58.25 160.25 59.416667 155.66667 60.5 106.83333 72.333333 68.166667 112.75 58.5 162.08333c-.916667 4.58334-1.833333 10.08334-2.083333 12.33334L56 178.33333h42 42V187.91667 197.5H98 55.916667l.416666 3.16667c4.166667 32.25 15.5 56.58333 36.333334 78.16666 9.750003 10.08334 18.250003 16.66667 30.083333 23.5 13.5 7.75 32 13.91667 47.66667 15.91667 3.25.33333 6.08333.75 6.5.83333.33333.0.58333-18.83333.58333-42z" id="path2007" style="fill:#fff;fill-opacity:1;stroke-width:.08333334" inkscape:connector-curvature="0"/><path d="M162.33333 311.66667C117.58333 302.25 80.666667 269.08333 66.833333 225.83333 64.75 219.16667 61.666667 205.91667 61.666667 203.25c0-.41667 17.166666-.75 39.916663-.75 35.25.0 40.08334-.16667 41.25-1.33333 1.08334-1.08334 1.33334-3.5 1.33334-13.25s-.25-12.16667-1.33334-13.25c-1.16666-1.16667-6-1.33334-41.25-1.33334-22.749997.0-39.916663-.33333-39.916663-.75.0-2.66666 3.083333-15.91666 5.166666-22.58333C79.166667 111.58333 110.75 80 149.16667 67.666667 155.83333 65.583333 169.08333 62.5 171.75 62.5c.41667.0.75 6 .75 13.25.0 11 .25 13.5 1.33333 14.583333 1.91667 1.916667 24.58334 1.916667 26.5.0C201.41667 89.25 201.66667 86.75 201.66667 75.75c0-7.25.33333-13.25.75-13.25 2.66666.0 15.91666 3.083333 22.58333 5.166667C263.41667 80 295 111.58333 307.33333 150c2.08334 6.66667 5.16667 19.91667 5.16667 22.58333.0.41667-6 .75-13.25.75-11 0-13.5.25-14.58333 1.33334-1.08334 1.08333-1.33334 3.5-1.33334 13.25s.25 12.16666 1.33334 13.25C285.75 202.25 288.25 202.5 299.25 202.5c7.25.0 13.25.33333 13.25.75.0 2.66667-3.08333 15.91667-5.16667 22.58333-6.16666 19.25-16.41666 35.83334-31.41666 50.91667C260.83333 291.75 244.25 302 225 308.16667c-6.66667 2.08333-19.91667 5.16666-22.58333 5.16666-.41667.0-.75-17.16666-.75-39.91666.0-35.25-.16667-40.08334-1.33334-41.25-1.91666-1.91667-24.58333-1.91667-26.5.0-1.16666 1.16666-1.33333 6-1.33333 41.25.0 37.5-.0833 39.91666-1.41667 39.83333-.83333.0-4.75-.75-8.75-1.58333zm38-89.66667c1.08334-1 1.33334-3.25 1.33334-10.41667V202.5H210.75c7.16667.0 9.41667-.25 10.41667-1.33333 1.91666-1.91667 1.91666-24.58334.0-26.5-1-1.08334-3.25-1.33334-10.41667-1.33334h-9.08333V164.25c0-7.16667-.25-9.41667-1.33334-10.41667-1.08333-1.08333-3.5-1.33333-13.25-1.33333s-12.16666.25-13.25 1.33333c-1.08333 1-1.33333 3.25-1.33333 10.41667v9.08333h-9.08333c-7.16667.0-9.41667.25-10.41667 1.33334-1.91667 1.91666-1.91667 24.58333.0 26.5 1 1.08333 3.25 1.33333 10.41667 1.33333H172.5v9.08333c0 7.16667.25 9.41667 1.33333 10.41667 1.91667 1.91667 24.58334 1.91667 26.5.0z" id="path2009" style="fill:none;stroke-width:.08333334" inkscape:connector-curvature="0"/><path d="M177.5 207.91667V197.5h-10.41667-10.41666v-9.58333-9.58334H167.08333 177.5V167.91667 157.5h9.58333 9.58334v10.41667 10.41666H207.08333 217.5v9.58334V197.5h-10.41667-10.41666v10.41667 10.41666H187.08333 177.5z" id="path2011" inkscape:connector-curvature="0" style="stroke-width:.08333334;fill:#fff;fill-opacity:1"/></g></svg></span><span class="text-uppercase font-weight-bold">Index</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/branch/doc/docs/><span class=active>Index Assembly</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/branch/doc/openpnp/><span>OpenPnP</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Releases</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=https://docs.indexmachines.io/>main</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/branch/doc/offline-search-index.d0d5b41c185c625962128f283b6f60ef.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="print();return false;">Click here to print</a>.</p><p><a href=/branch/doc/docs/motherboard/>Return to the regular view of this page</a>.</p></div><h1 class=title>Motherboard Installation</h1><div class=lead>Section containing reference documentation.</div><ul><li>1: <a href=#pg-0f9ced783d7b1ac86af068c0f8cd82cc>Install THT Components</a></li><li>2: <a href=#pg-ac3b1cc178ed78d50ae1b5b07df7a787>Mounting the Motherboard</a></li><li>3: <a href=#pg-fdcbe6b238f034917a3143ddea861058>Adjust Stepper Motor Driver Current</a></li><li>4: <a href=#pg-5985c31b9f045ac5710aa4a06bcf6846>Update the Firmware</a></li></ul><div class=content><h2 id=introduction>Introduction</h2><p>This part of the documentation contains some topics such as</p><ul><li>A glossary of key terms</li><li>How to contribute to the project</li><li>How to build and work with the documentation</li><li>Images of the various 3d printed parts for reference</li></ul></div></div><div class=td-content><h1 id=pg-0f9ced783d7b1ac86af068c0f8cd82cc>1 - Install THT Components</h1><div class=lead>Instructions about how to install the THT components into an Index Motherboard</div><p>There are five types of connectors that need to be soldered into your motherboard. We&rsquo;ll go over each one, and how to solder them in place.</p><h2 id=screw-terminal>Screw Terminal</h2><p>In your connector bag you&rsquo;ll find a screw terminal connector. This provides power to the machine, and goes into the <code>J12</code> footprint on the upper-right corner of the board. Ensure that the openings that accept the power cables are facing outwards.</p><p>TODO: picture of the board with the connector soldered in correctly</p><h2 id=idc-connectors>IDC Connectors</h2><p>The IDC connectors are the larger, black connectors in your connector bag. There are only two sizes, a 2x3 for feeder communication, and three 2x6 for the auxillary ports. Be sure to solder them the correct orientation. The slot on the connector should match up with the silkscreen.</p><p>TODO: picture of these locations on the board, and connectors</p><h2 id=jst-xh-connectors>JST XH Connectors</h2><p>The bulk of the connectors on the board are JST XH connectors. These come in two, three, and four pin variations. The two pin connectors are for the mosfets, the three pin connectors are for the servos, limit switches, and ring lights, and the four pin connectors are for the stepper motors. Be sure to solder these with the correct orientation as dictated by the silkscreen.</p><p>TODO: pics of all this</p><h2 id=usb-a-connectors>USB A Connectors</h2><p>There are three USB A connectors that need to be soldered into the board as well. Two of these are for the webcams, and the third is for future functionality. We recommend soldering the large structural tabs in place first, then soldering the four data pins afterward.</p><p>TODO: pics of all this</p><h2 id=stepper-motor-driver-headers>Stepper Motor Driver Headers</h2><p>The last connectors that need to be soldered into the board are the 1x8 Dupont 0.1" headers for the stepper motor drivers. Two connectors need to be soldered for each driver. We recommend soldering a single pin in place first while getting the connector to stay flat, then do the rest of the pins after the orientation is solidified. Orientation does not matter for these connectors.</p><p>TODO: pics of all this</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ac3b1cc178ed78d50ae1b5b07df7a787>2 - Mounting the Motherboard</h1><div class=lead>Instructions about how to mount the motherboard on the staging plate</div><p>Now that we&rsquo;ve got all the THT components soldered in, it&rsquo;s time to mount the motherboard to the staging plate.</p><p>It&rsquo;s important to make sure we&rsquo;re mounting the motherboard in the correct place on the staging plate so that all the cables fit and reach their respective ports correctly. Put your Lumen up on its haunches and take a look at the left side of the staging plate. Reference the picture below for which holes you should mount the 25mm standoffs. Pass four M3 x 8mm screws through the top side of the staging plate, and tighten them into the standoffs.</p><p>TODO(pic of standoffs mounted to staging plate)</p><p>Now we can mount the motherboard itself. Take the board, and ensuring that the USB ports are facing to the left, and the vacuum sensors on the bottom, thread another four M3 x 8mm screws through the mounting holes on the motherboard into the standoffs.</p><p>TODO(show mobo mounted to standoffs, someone tightening the bolts)</p></div><div class=td-content style=page-break-before:always><h1 id=pg-fdcbe6b238f034917a3143ddea861058>3 - Adjust Stepper Motor Driver Current</h1><div class=lead>Instructions on how to adjust the current setting on your stepper motor drivers.</div><p>The amount of current running through the Index&rsquo;s stepper motors needs to be adjusted before use.</p><h2 id=installation-and-power>Installation and Power</h2><p>To begin, install the four stepper motor drivers into the X, Y, Z, and Left Head slots.</p><p>TODO(pic of four drivers installed)</p><p>Next, cut the connector off of the end of the power supply cable. Then separate the two wires, strip off the insulation of each. Twist the stranded copper and insert the wire with the white stripe into the positive side of the power screw terminal on the motherboard. Insert the black wire into the other terminal, and screw both down tightly.</p><p>TODO(pic of cutting connector)
TODO(pic of stripped cable)
TODO(pic of cables inserted, being tightened)</p><p>Next, plug in your power brick. Watch for a yellow light by the screw terminal. If you do not see a yellow light, check to make sure you inserted the wires into the correct terminals. Also check to see if the light on the power brick is illuminated.</p><p>TODO(pic of power light on mobo)
TODO(pic of power light on brick)</p><p>It is very important to not plug in or unplug stepper motor drivers or motors while the board is powered on. Make sure to unplug the power supply before inserting or removing drivers or motors.</p><h2 id=current-adjustment>Current Adjustment</h2><p>Now that your board is powered up, it&rsquo;s time to adjust the driver current. This is done by turning a potentiometer with a small flathead screwdriver (one is provided in your PCB kit).</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Caution</h4>The screwdriver included in your kit has a ceramic tip to prevent any accidential conduction. This means that it is very fragile. Be incredibly careful with the tip, and do not apply any excessive force when adjusting the potentiometer.</div><p>On any driver, use a multimeter to measure the voltage between the <code>GND</code> pin and the <code>Vref</code> pad as shown in the image below.</p><figure><img src=https://docs.indexmachines.io/branch/doc/docs/motherboard/adjust-stepper-drivers/images/TMC2209_vref_V30_hu2f5e9c04b7ddf80f87f97329480b6386_232520_1000x700_fit_q75_catmullrom.jpeg alt="Where to probe a 2209"></figure><p>This voltage dictates how much current the driver will run through the stepper motor, and can be adjusted by turning the potentiometer (shown in the diagram above). The table below shows what voltage you should adjust each driver to:</p><table><thead><tr><th>Motor</th><th>Voltage</th></tr></thead><tbody><tr><td>X</td><td>1.2v</td></tr><tr><td>Y</td><td>2.1v</td></tr><tr><td>Z</td><td>1.2v</td></tr><tr><td>Left Head</td><td>0.7v</td></tr></tbody></table><p>Your drivers are now configured to drive your motors correctly. For more information about adjusting your stepper motor drivers, <a href=https://wiki.fysetc.com/Silent2209/>click here</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-5985c31b9f045ac5710aa4a06bcf6846>4 - Update the Firmware</h1><div class=lead>Flash Marlin onto the motherboard.</div><p>Your motherboard comes with a correct build of Marlin pre-installed, but if you&rsquo;d like to update the firmware or change settings, this will help you do so!</p><h2 id=necessary-components>Necessary Components</h2><ul><li>Index Mobo</li><li>USB-A / USB-C cable</li></ul><h2 id=process>Process</h2><ol><li><p>Download the <a href=https://github.com/MarlinFirmware/Marlin/archive/2.0.x.zip>latest Marlin firmware</a> and unzip it</p></li><li><p>Install <a href=https://code.visualstudio.com/>VSCode</a> and its <a href="https://marketplace.visualstudio.com/items?itemName=platformio.platformio-ide">PlatformIO extension</a></p></li><li><p>Open Marlin firmware&rsquo;s folder on VSCode</p></li><li><p>Grab Marlin configuration files (<a href=https://github.com/MarlinFirmware/Configurations/raw/import-2.0.x/config/examples/Index/REV_03/Configuration.h>this</a> and <a href=https://github.com/MarlinFirmware/Configurations/raw/import-2.0.x/config/examples/Index/REV_03/Configuration_adv.h>this</a>) and replace the files on Marlin/Marlin folder with those new ones</p></li><li><p>Attach the Index Mobo to your computer with the USB cable</p></li><li><p>Boot the STM32 in DFU Mode</p><ol><li>Press and hold the <code>BOOT</code> button</li><li>Press the Reset button</li><li>Release the Reset button</li><li>Release the <code>BOOT</code> button</li></ol></li><li><p>Upload firmware to the board:<figure><img src=https://docs.indexmachines.io/branch/doc/docs/motherboard/update-firmware/images/vscode_marlin_env_hu261360645cb01b1aa2cb32a8535f67f0_51103_1000x700_fit_catmullrom_2.png alt="Upload firmware via PIO"></figure></p></li><li><p>Wait for the process to finish:<figure><img src=https://docs.indexmachines.io/branch/doc/docs/motherboard/update-firmware/images/PIO_upload_done_hu1cb99c7b821bc8f1cdab7b58d56b0222_12141_1000x700_fit_catmullrom_2.png alt="PIO firmware upload done"></figure></p></li><li><p>Press Reset on the board. Now it should show up as a COM/Serial Port on your PC:</p></li></ol><p>Windows:<figure><img src=https://docs.indexmachines.io/branch/doc/docs/motherboard/update-firmware/images/STM32_COM_port_connected_hu18736bad201488dc0f879e2ef87cc2c9_15956_1000x700_fit_catmullrom_2.png alt="STM32 shows up as a COM/Serial Port"></figure></p><p>Linux:<figure><img src=https://docs.indexmachines.io/branch/doc/docs/motherboard/update-firmware/images/linux_lsusb_hu2c102318d164e9c5aa9a60d19a31b572_59314_1000x700_fit_catmullrom_2.png alt="STM32 shows up on lsusb"></figure></p><h3 id=troubleshooting-dfu-upload><strong>Troubleshooting DFU Upload:</strong></h3><ul><li>Make sure, that your board shows up correctly in DFU mode:</li></ul><p>Windows:<figure><img src=https://docs.indexmachines.io/branch/doc/docs/motherboard/update-firmware/images/dfu_mode_device_manager_hu13613d0250acaa964ae16d4e6eaf14fa_54346_1000x700_fit_catmullrom_2.png alt="STM32 in DFU mode in Device Manager"></figure></p><p>Linux:<figure><img src=https://docs.indexmachines.io/branch/doc/docs/motherboard/update-firmware/images/linux_lsusb_bootloader_hu098a8f28f310b4b390623eb3a3e4ffd1_59328_1000x700_fit_catmullrom_2.png alt="STM32 in DFU mode in lsusb"></figure></p><ul><li>If the upload through VS Code does not work but the device is connected properly, edit the PIO config file (platformio.ini, located in the project folder):</li></ul><ol><li>Create a backup of the config file</li><li>Search for &ldquo;STM32F407VE_black&rdquo; and replace the existing section with the following:</li></ol><pre><code>#
# STM32F407VET6 with RAMPS-like shield
# 'Black' STM32F407VET6 board - https://wiki.stm32duino.com/index.php?title=STM32F407
# Shield - https://github.com/jmz52/Hardware
#
[env:STM32F407VE_black]
platform          = ${common_stm32.platform}
extends           = common_stm32
board             = blackSTM32F407VET6
# upload_port       = 0483:df11
upload_protocol   = dfu
upload_command    = dfu-util -a 0 -s 0x08000000:leave -D &quot;$SOURCE&quot;
board_build.f_cpu = 12000000L
build_flags       = ${common_stm32.build_flags}
  -D ARDUINO_BLACK_F407VE
   -D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC
   -D USBD_USE_CDC_COMPOSITE
  ; -D MENU_USB_SERIAL 
  ; -D MENU_SERIAL=SerialUSB
  ; -D USBCON 
   -D USBD_VID=0x0483
   -D USBD_PID=0x5740
   -DLSE_VALUE=32768U
   -DHSE_VALUE=12000000U
  ; -D USB_MANUFACTURER=&quot;Unknown&quot;
  -D USB_PRODUCT=\&quot;BLACK_F407VE\&quot;
  ; -D HAL_PCD_MODULE_ENABLED
  ;-D PIO_FRAMEWORK_ARDUINO_SERIAL_WITHOUT_GENERIC
  -D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC
  ;-D PIO_FRAMEWORK_ARDUINO_NANOLIB_FLOAT_PRINTF
  ;-D PIO_FRAMEWORK_ARDUINO_USB_HIGHSPEED_FULLMODE
   
  

extra_scripts     = ${common.extra_scripts}
  pre:buildroot/share/PlatformIO/scripts/generic_create_variant.py
lib_ignore        = SoftwareSerial
</code></pre><p>Notice that <code>upload_port = 0483:df11</code> is commented out. This setting caused issues, at least for some users. After disabling it, uploading via PIO worked.</p><h4 id=things-to-check-if-the-board-doesnt-show-up-as-stm32-bootloader><strong>Things to check if the board doesn&rsquo;t show up as &ldquo;STM32 BOOTLOADER&rdquo;:</strong></h4><ul><li>Check if the USB hub works by connecting devices to other ports. This is not an absolute guarantee that the connection to the STM32 works though.</li><li>Check if all solder joints look fine</li><li>Check if all necessary voltages are present (Mobo input voltage, 5V rail and 3.3V rail)</li><li>Keep in mind that a blank STM32 should still appear as a USB device, even if it has no firmware loaded onto it</li><li>Check the 8MHz crystal oscillator of the SMT32. Its correct operation is important for DFU. Wrong frequency and / or incorrect load capacitors can cause issues. Use an oscilloscope to probe the signal. You should see a smooth sine wave with stable frequency.</li></ul><h4 id=alternative-method-to-upload><strong>Alternative method to upload:</strong></h4><p>This method requires an ST-Link (V2 Clone or equivalent). Additionally you need the software <a href=https://www.st.com/en/development-tools/stm32cubeprog.html>STM32CubeProgrammer</a> by ST. This method is a bit more involved and takes longer than just using the DFU mode.</p><ol><li><p>Compile (build) the project normally with PIO</p></li><li><p>This generates a .bin-file that contains the firmware</p></li><li><p>Connect your board to your ST-Link through the SWD header on board</p></li><li><p>Start STM32CubeProgrammer</p></li><li><p>Connect to the MCU:<figure><img src=https://docs.indexmachines.io/branch/doc/docs/motherboard/update-firmware/images/connect_STM_to_programmer_hu3f6d180b9c7a5de6a1811ee5f8472d4e_21915_1000x700_fit_catmullrom_2.png alt="Connecting to the STM programmer"></figure></p></li><li><p>Click on <strong>Open file</strong> and navigate to the <strong>firmware.bin</strong> file in <em>PROJECT_DIRECTORY/.pio/build/STM32F407VE_black</em><figure><img src=https://docs.indexmachines.io/branch/doc/docs/motherboard/update-firmware/images/open_firmware_bin_file_hu7a25ff17e11c8cbc9e1a3391711fe53a_116261_1000x700_fit_catmullrom_2.png alt="Opening the compiled firmware file"></figure></p></li><li><p>Click on <strong>Download</strong>. This will flash the SMT32F4 with the provided firmware<figure><img src=https://docs.indexmachines.io/branch/doc/docs/motherboard/update-firmware/images/start_firmware_download_hu35590dbeb7d887c76c2b6bdd0fe75df5_46720_1000x700_fit_catmullrom_2.png alt="Downloading (flashing) the firmware"></figure></p></li><li><p>Done! Now you just have to disconnect the ST-Link and press Reset on the board (img/firmware_download_done.png" alt=&ldquo;Firmware flashing success&rdquo; >}}</p></li></ol></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/stephentherobot><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Instagram aria-label=Instagram><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.instagram.com/stephentherobot/><i class="fab fa-instagram"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/index-machines/index><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel="noopener noreferrer" href=https://discordapp.com/invite/TCwy6De><i class="fab fa-discord"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js integrity=sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s crossorigin=anonymous></script><script src=/branch/doc/js/main.min.f820bfc507c3ebefe17f8881ec4ee10013f3b89ad9555a50acf9bb1771e6823f.js integrity="sha256-+CC/xQfD6+/hf4iB7E7hABPzuJrZVVpQrPm7F3Hmgj8=" crossorigin=anonymous></script></body></html>